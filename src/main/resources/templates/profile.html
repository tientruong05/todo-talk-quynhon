<!DOCTYPE html>
<html
  lang="vi"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout}"
>
  <div layout:fragment="content">
    <!-- Full Screen Profile Layout with Auth Style -->
    <div class="h-screen digital-gradient relative overflow-hidden">
      <!-- Geometric Background Elements -->
      <div class="absolute inset-0 pointer-events-none overflow-hidden">
        <!-- Animated Geometric Shapes -->
        <div class="geometric-shape top-20 left-20">
          <div class="shape-triangle"></div>
        </div>
        <div class="geometric-shape top-40 right-32 w-16 h-16 shape-circle"></div>
        <div class="geometric-shape bottom-32 left-1/4 w-20 h-20 shape-polygon"></div>
        <div class="geometric-shape top-1/3 right-1/4">
          <div class="shape-triangle" style="animation-delay: 3s;"></div>
        </div>
        <div class="geometric-shape bottom-20 right-20 w-12 h-12 shape-circle" style="animation-delay: 2s;"></div>

        <!-- Mesh Gradient Overlay -->
        <div class="absolute inset-0 mesh-gradient opacity-60"></div>
      </div>

      <!-- Profile Container -->
      <div class="relative z-10 h-full flex items-center justify-center p-8">
        <div class="w-full max-w-2xl">
          <!-- Success/Error Messages -->
          <div
            th:if="${success}"
            class="mb-6 p-4 glass-card border border-green-400/30 text-green-100 rounded-xl"
          >
            <div class="flex items-center">
              <i class="fas fa-check-circle mr-3 text-green-400"></i>
              <span th:text="${success}"></span>
            </div>
          </div>

          <div
            th:if="${error}"
            class="mb-6 p-4 glass-card border border-red-400/30 text-red-100 rounded-xl"
          >
            <div class="flex items-center">
              <i class="fas fa-exclamation-circle mr-3 text-red-400"></i>
              <span th:text="${error}"></span>
            </div>
          </div>

          <!-- Main Profile Card -->
          <div class="glass-card rounded-3xl p-8 lg:p-10 relative overflow-hidden">
            <!-- Background Pattern -->
            <div class="absolute inset-0 opacity-5">
              <div class="absolute top-6 right-6 w-24 h-24 border border-white rounded-full"></div>
              <div class="absolute bottom-6 left-6 w-16 h-16 border border-white rounded-full"></div>
              <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-32 border border-white rounded-full"></div>
            </div>

            <!-- Profile Header -->
            <div class="relative z-10 text-center mb-8">
              <div class="inline-flex items-center justify-center w-20 h-20 glass-card rounded-3xl mb-4">
                <i class="fas fa-user-cog text-3xl text-gradient"></i>
              </div>
              <h1 class="text-4xl font-bold text-white mb-2">Thông Tin Cá Nhân</h1>
              <p class="text-white/70">Quản lý thông tin tài khoản của bạn</p>
            </div>

            <!-- Avatar Upload Section -->
            <div class="mb-8">
              <div class="flex flex-col items-center">
                <div class="relative mb-6">
                  <div class="w-32 h-32 rounded-full overflow-hidden border-4 border-white/30 shadow-lg">
                    <img
                      id="avatarPreview"
                      th:src="${user.avatarUrl} ?: 'https://via.placeholder.com/128'"
                      alt="Avatar"
                      class="w-full h-full object-cover"
                    >
                  </div>
                  <button
                    type="button"
                    onclick="document.getElementById('avatarInput').click()"
                    class="absolute bottom-0 right-0 w-10 h-10 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors flex items-center justify-center shadow-lg"
                    title="Thay đổi ảnh đại diện"
                  >
                    <i class="fas fa-camera text-sm"></i>
                  </button>
                </div>
                <h2 class="text-2xl font-bold text-white mb-1" th:text="${user.fullName} ?: ${user.username}">Tên người dùng</h2>
                <p class="text-white/70 mb-1" th:text="'@' + ${user.username}">@username</p>
                <p class="text-white/60 text-sm" th:text="${user.email}">email@example.com</p>
              </div>
            </div>

            <!-- Profile Form -->
            <form th:action="@{/profile}" method="POST" enctype="multipart/form-data" th:object="${user}" class="space-y-6">
              <!-- Hidden Avatar Input -->
              <input
                type="file"
                id="avatarInput"
                name="avatarFile"
                accept="image/*"
                class="hidden"
                onchange="previewAvatar(this)"
              >

              <!-- Username -->
              <div>
                <label for="username" class="block text-sm font-medium text-white/90 mb-3">
                  <i class="fas fa-user mr-2 text-blue-400"></i>Tên Đăng Nhập
                </label>
                <input
                  type="text"
                  id="username"
                  name="username"
                  th:value="${user.username}"
                  readonly
                  class="input-modern w-full px-4 py-3 rounded-xl outline-none bg-white/50 cursor-not-allowed"
                />
                <p class="text-xs text-white/60 mt-2">Tên đăng nhập không thể thay đổi</p>
              </div>

              <!-- Email -->
              <div>
                <label for="email" class="block text-sm font-medium text-white/90 mb-3">
                  <i class="fas fa-envelope mr-2 text-blue-400"></i>Địa Chỉ Email
                </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  th:value="${user.email}"
                  class="input-modern w-full px-4 py-3 rounded-xl outline-none"
                  required
                />
              </div>

              <!-- Full Name -->
              <div>
                <label for="fullName" class="block text-sm font-medium text-white/90 mb-3">
                  <i class="fas fa-id-card mr-2 text-blue-400"></i>Họ Và Tên
                </label>
                <input
                  type="text"
                  id="fullName"
                  name="fullName"
                  th:value="${user.fullName}"
                  class="input-modern w-full px-4 py-3 rounded-xl outline-none"
                  placeholder="Nhập họ và tên đầy đủ"
                />
              </div>

              <!-- Action Buttons -->
              <div class="flex flex-col sm:flex-row gap-4 mt-8">
                <a
                  th:href="@{/message}"
                  class="flex-1 py-3 px-6 glass-card text-white font-semibold rounded-xl focus:outline-none text-center hover:bg-white/20 transition-colors"
                >
                  <i class="fas fa-arrow-left mr-2"></i>Quay Lại Messages
                </a>

                <button
                  type="submit"
                  class="flex-1 btn-modern py-3 px-6 text-white font-semibold rounded-xl focus:outline-none"
                >
                  <i class="fas fa-save mr-2"></i>Lưu Thay Đổi
                </button>
              </div>
            </form>

            <!-- Account Information -->
            <div class="mt-8 pt-6 border-t border-white/20">
              <h3 class="text-lg font-medium text-white mb-4">
                <i class="fas fa-info-circle mr-2 text-blue-400"></i>Thông Tin Tài Khoản
              </h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                <div class="glass-card p-4 rounded-xl">
                  <span class="font-medium text-white/90">Thành viên từ:</span>
                  <div class="text-white/70 mt-1" th:text="${#temporals.format(user.createdAt, 'dd/MM/yyyy')}">01/01/2024</div>
                </div>
                <div class="glass-card p-4 rounded-xl">
                  <span class="font-medium text-white/90">Cập nhật lần cuối:</span>
                  <div class="text-white/70 mt-1" th:text="${#temporals.format(user.updatedAt, 'dd/MM/yyyy')}">01/01/2024</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  <script layout:fragment="script">
    // Avatar preview function
    function previewAvatar(input) {
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('avatarPreview').src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
      }
    }

    // Form validation
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.querySelector('form');
      const emailInput = document.getElementById('email');
      const fullNameInput = document.getElementById('fullName');

      form.addEventListener('submit', function(e) {
        let isValid = true;

        // Email validation
        if (!emailInput.value || !emailInput.value.includes('@')) {
          showError('Vui lòng nhập địa chỉ email hợp lệ');
          isValid = false;
        }

        if (!isValid) {
          e.preventDefault();
        }
      });

      // Real-time email validation
      emailInput.addEventListener('blur', function() {
        if (this.value && !this.value.includes('@')) {
          this.style.borderColor = '#ef4444';
        } else {
          this.style.borderColor = '';
        }
      });
    });

    function showError(message) {
      // Create error notification
      const errorDiv = document.createElement('div');
      errorDiv.className = 'fixed top-4 right-4 p-4 glass-card border border-red-400/30 text-red-100 rounded-xl z-50';
      errorDiv.innerHTML = `
        <div class="flex items-center">
          <i class="fas fa-exclamation-circle mr-3 text-red-400"></i>
          <span>${message}</span>
        </div>
      `;

      document.body.appendChild(errorDiv);

      // Remove after 3 seconds
      setTimeout(() => {
        errorDiv.remove();
      }, 3000);
    }
  </script>

  <style layout:fragment="style">
    /* Auth-style CSS Variables */
    :root {
      --primary-purple: #8b5cf6;
      --primary-blue: #3b82f6;
      --primary-pink: #ec4899;
      --primary-orange: #f97316;
      --dark-bg: #0f0f23;
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
    }

    /* Digital gradient background */
    .digital-gradient {
      background: linear-gradient(
        135deg,
        #0f0f23 0%,
        #1e1b4b 20%,
        #312e81 40%,
        #4c1d95 60%,
        #7c3aed 80%,
        #a855f7 100%
      );
      position: relative;
    }

    .digital-gradient::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(circle at 25% 25%, rgba(139, 92, 246, 0.4) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(59, 130, 246, 0.4) 0%, transparent 50%),
        radial-gradient(circle at 75% 25%, rgba(236, 72, 153, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 25% 75%, rgba(249, 115, 22, 0.3) 0%, transparent 50%);
      pointer-events: none;
      animation: gradientShift 8s ease-in-out infinite;
    }

    @keyframes gradientShift {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    /* Geometric shapes */
    .geometric-shape {
      position: absolute;
      animation: geometricFloat 12s ease-in-out infinite;
    }

    .shape-triangle {
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 35px solid rgba(139, 92, 246, 0.3);
      animation: triangleRotate 15s linear infinite;
    }

    .shape-circle {
      border-radius: 50%;
      background: linear-gradient(45deg, rgba(59, 130, 246, 0.3), rgba(236, 72, 153, 0.3));
      animation: circleFloat 10s ease-in-out infinite;
    }

    .shape-polygon {
      background: rgba(249, 115, 22, 0.3);
      clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
      animation: polygonSpin 20s linear infinite;
    }

    @keyframes geometricFloat {
      0%, 100% { transform: translateY(0px) translateX(0px); }
      25% { transform: translateY(-30px) translateX(20px); }
      50% { transform: translateY(-10px) translateX(-15px); }
      75% { transform: translateY(-25px) translateX(10px); }
    }

    @keyframes triangleRotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @keyframes circleFloat {
      0%, 100% { transform: scale(1) translateY(0px); }
      50% { transform: scale(1.1) translateY(-20px); }
    }

    @keyframes polygonSpin {
      from { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.2); }
      to { transform: rotate(360deg) scale(1); }
    }

    /* Glass effects */
    .glass-card {
      backdrop-filter: blur(25px);
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 25px 45px rgba(0, 0, 0, 0.2);
    }

    /* Text gradients */
    .text-gradient {
      background: linear-gradient(135deg, #ffffff 0%, var(--primary-purple) 50%, var(--primary-pink) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Modern button */
    .btn-modern {
      background: linear-gradient(135deg, var(--primary-purple) 0%, var(--primary-pink) 100%);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
    }

    .btn-modern:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 35px rgba(139, 92, 246, 0.6);
      background: linear-gradient(135deg, var(--primary-pink) 0%, var(--primary-orange) 100%);
    }

    /* Modern input */
    .input-modern {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
    }

    .input-modern:focus {
      background: rgba(255, 255, 255, 0.95);
      border-color: var(--primary-purple);
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
    }

    /* Mesh gradient */
    .mesh-gradient {
      background: radial-gradient(circle at 20% 50%, rgba(139, 92, 246, 0.3) 0%, transparent 50%),
                  radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.3) 0%, transparent 50%),
                  radial-gradient(circle at 40% 80%, rgba(236, 72, 153, 0.3) 0%, transparent 50%);
      animation: meshMove 10s ease-in-out infinite;
    }

    @keyframes meshMove {
      0%, 100% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.1) rotate(5deg); }
    }

    /* Avatar hover effect */
    #avatarPreview {
      transition: transform 0.3s ease;
    }

    #avatarPreview:hover {
      transform: scale(1.05);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .glass-card {
        margin: 1rem;
        padding: 1.5rem !important;
      }
    }
  </style>
</html>
